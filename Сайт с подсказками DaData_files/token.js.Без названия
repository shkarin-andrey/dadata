define("main/helpers/token",["jquery","popups"],function(e,t){function n(){var t={generate_token:"",generate_secret:""};return e.ajax({url:"/profile/generate-key/",type:"post",data:t})}function r(t){e(".js-has-token").each(function(n,r){var i=e(r),s=i.text();s=s.replace("${API_KEY}",t.auth_token),s=s.replace("${SECRET_KEY}",t.auth_secret);var o=i.find("code");o.length||(o=i),o.text(s)})}function i(i){function o(){return s.hasClass("link-disabled")}function u(){s.attr("disabled","disabled"),s.addClass("link-disabled")}function a(){s.removeAttr("disabled"),s.removeClass("link-disabled")}function f(){s.append(e("<span> (сделано)</span>"))}var s=e(i);if(o())return;u(),n().done(function(e){r(e),f()}).fail(function(e){var n;e.status===403?t.showMessage(e.responseText):(n="Не удалось сгенерировать API ключ",t.showError([n])),a()})}return e(function(){e(".js-button-get-token").click(function(e){e.preventDefault(),i(e.target)})}),{}});